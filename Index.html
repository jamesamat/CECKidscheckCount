<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chuck E. Cheese Guest Counter</title>
  <meta name="viewport" content="width=768, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: linear-gradient(135deg, #a78bfa, #10b981);
    }
    body {
      font-family: Arial, Helvetica, sans-serif;
      height: 100vh;
      width: 100vw;
      box-sizing: border-box;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .container {
      width: 700px;
      height: 900px;
      background: #fff;
      border-radius: 32px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.11);
      padding: 24px 18px 14px 18px;
      display: flex;
      flex-direction: column;
      align-items: center;
      box-sizing: border-box;
      justify-content: flex-start;
      /* Prevent all overflow */
      overflow: hidden;
    }
    .header {
      text-align: center;
      margin-bottom: 12px;
    }
    .header h1 {
      color: #7c3aed;
      font-size: 2.2em;
      margin-bottom: 2px;
    }
    .header h2 {
      color: #333;
      font-size: 1.08em;
      margin-bottom: 2px;
    }
    .categories {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(2, 1fr);
      gap: 10px;
      width: 100%;
      margin-bottom: 12px;
    }
    .categories button {
      min-width: 0;
      width: 100%;
      padding: 11px 2px;
      border-radius: 14px;
      border: 2px solid #eee;
      background: #a78bfa;
      color: #fff;
      font-size: 1.14em;
      font-weight: bold;
      cursor: pointer;
      transition: border 0.2s;
      height: 60px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    .categories button.selected {
      border: 2px solid #10b981;
      background: #7c3aed;
    }
    /* Adult button only */
    #btn-adult {
      grid-column: 2 / span 1;
      grid-row: 2 / span 1;
    }
    .display {
      text-align: center;
      margin-bottom: 8px;
      background: #7c3aed;
      border-radius: 15px;
      padding: 15px 0 8px 0;
      color: #fff;
      width: 100%;
    }
    .display #categoryDisplay {
      font-size: 1.08em;
      margin-bottom: 2px;
    }
    .display #display {
      font-size: 2.7em;
      margin-bottom: 2px;
    }
    .display .max {
      font-size: 1em;
      color: #ede9fe;
    }
    .keypad {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      grid-template-rows: repeat(2, 1fr);
      gap: 10px;
      width: 100%;
      margin-bottom: 12px;
    }
    .keypad button {
      width: 100%;
      min-width: 0;
      padding: 13px 0;
      border-radius: 10px;
      border: none;
      background: #10b981;
      color: #fff;
      font-size: 1.18em;
      font-weight: bold;
      cursor: pointer;
      height: 50px;
      box-sizing: border-box;
    }
    .controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      margin-bottom: 7px;
      width: 100%;
    }
    .controls button {
      padding: 13px 0;
      border-radius: 10px;
      border: none;
      color: #fff;
      font-weight: bold;
      font-size: 1.08em;
      cursor: pointer;
      height: 50px;
      box-sizing: border-box;
      width: 100%;
    }
    .reset { background: #7c3aed; }
    .checkin { background: #10b981; }
    #statusMessage {
      text-align: center;
      min-height: 22px;
      color: #eab308;
      font-size: 1em;
      margin-bottom: 4px;
      height: 22px;
    }
    .summary {
      background: #ede9fe;
      border-radius: 10px;
      padding: 8px 10px;
      margin-top: 2px;
      width: 100%;
      box-sizing: border-box;
    }
    .summary h3 {
      text-align: center;
      color: #7c3aed;
      margin-bottom: 4px;
      font-size: 1em;
    }
    .summary-table {
      width: 100%;
      font-size: 0.97em;
      color: #7c3aed;
    }
    .summary-table td {
      padding: 3px 0;
      font-size: 1em;
    }
    .summary-table td.value {
      color: #10b981;
      font-weight: bold;
      text-align: right;
    }
    /* Prevent all scrolling */
    * {
      overscroll-behavior: contain;
      box-sizing: border-box;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div style="font-size:2.5em;">üé™</div>
      <h1>Chuck E. Cheese</h1>
      <h2>Guest Counter</h2>
    </div>
    <div class="categories" id="categories">
      <button onclick="selectCategory('toddler')" id="btn-toddler">üë∂ Toddler<br><span style="font-size:0.92em;font-weight:normal;">1-3</span></button>
      <button onclick="selectCategory('preschool')" id="btn-preschool">üßí Preschool<br><span style="font-size:0.92em;font-weight:normal;">4-5</span></button>
      <button onclick="selectCategory('school')" id="btn-school">üéí School<br><span style="font-size:0.92em;font-weight:normal;">6-12</span></button>
      <!-- Empty grid cell for adult button alignment -->
      <div style="visibility:hidden"></div>
      <button onclick="selectCategory('adult')" id="btn-adult">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Adult<br><span style="font-size:0.92em;font-weight:normal;">18+</span></button>
      <button onclick="selectCategory('teen')" id="btn-teen">üßë‚Äçüéì Teen<br><span style="font-size:0.92em;font-weight:normal;">13-17</span></button>
    </div>
    <div class="display">
      <div id="categoryDisplay">Select category</div>
      <div id="display">0</div>
      <div class="max">Max 999 guests</div>
    </div>
    <div class="keypad">
      <button onclick="addGuests(1)">1</button>
      <button onclick="addGuests(2)">2</button>
      <button onclick="addGuests(3)">3</button>
      <button onclick="addGuests(4)">4</button>
      <button onclick="addGuests(5)">5</button>
      <button onclick="addGuests(6)">6</button>
      <button onclick="addGuests(7)">7</button>
      <button onclick="addGuests(8)">8</button>
      <button onclick="addGuests(9)">9</button>
      <button onclick="addGuests(10)">10</button>
    </div>
    <div class="controls">
      <button class="reset" onclick="clearCounter()">RESET</button>
      <button class="checkin" onclick="submitGuests()" id="checkin-btn">CHECK IN</button>
    </div>
    <div id="statusMessage"></div>
    <div class="summary">
      <h3>Today's Summary</h3>
      <table class="summary-table">
        <tr><td>Toddler:</td><td class="value" id="summary-toddler">0</td></tr>
        <tr><td>Preschool:</td><td class="value" id="summary-preschool">0</td></tr>
        <tr><td>School:</td><td class="value" id="summary-school">0</td></tr>
        <tr><td>Teen:</td><td class="value" id="summary-teen">0</td></tr>
        <tr><td>Adult:</td><td class="value" id="summary-adult">0</td></tr>
        <tr><td style="font-weight:bold;">Total:</td><td class="value" id="summary-total">0</td></tr>
      </table>
    </div>
  </div>
  <script>
    let currentCount = 0;
    let selectedCategory = '';
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwBKAVUehbNDdgHtmXeWfTE-ibc7k9i8lrDc4JG2siRO7bj7Ask3-AKXbBHK0hgCd_p/exec";
    const maxCount = 999;
    const categoryTotals = {
      'toddler': 0,
      'preschool': 0,
      'school': 0,
      'teen': 0,
      'adult': 0
    };
    const categoryNames = {
      'toddler': 'Toddler (1-3 years)',
      'preschool': 'Preschool (4-5 years)',
      'school': 'School Age (6-12 years)',
      'teen': 'Teen (13-17 years)',
      'adult': 'Adult (18+ years)'
    };

    function selectCategory(cat) {
      selectedCategory = cat;
      document.getElementById('categoryDisplay').textContent = categoryNames[cat];
      Array.from(document.getElementById('categories').children).forEach(btn => btn.classList && btn.classList.remove('selected'));
      let btn = document.getElementById('btn-' + cat);
      if (btn) btn.classList.add('selected');
      clearStatus();
      updateCheckInButton();
    }

    function updateDisplay() {
      document.getElementById('display').textContent = currentCount;
      updateCheckInButton();
    }

    function addGuests(n) {
      if (!selectedCategory) { showStatus('Select a category first!', 'error'); return; }
      if (currentCount + n > maxCount) {
        showStatus('Maximum is ' + maxCount + ' guests!', 'error'); return;
      }
      currentCount += n;
      updateDisplay();
      clearStatus();
    }

    function clearCounter() {
      currentCount = 0;
      updateDisplay();
      clearStatus();
    }

    function submitGuests() {
      if (!selectedCategory) { showStatus('Select a category first!', 'error'); return; }
    if (currentCount === 0) { showStatus('Add guests first!', 'error'); return; }
    // POST to Google Sheets
    fetch(GOOGLE_SCRIPT_URL, {
        method: "POST",
        body: JSON.stringify({category: selectedCategory, count: currentCount}),
        headers: {"Content-Type": "application/json"}
    }).then(response => response.text())
        .then(() => {
        showStatus('‚úÖ ' + currentCount + ' ' + categoryNames[selectedCategory] + ' checked in!', 'success');
        setTimeout(() => { clearCounter(); clearStatus(); fetchSummary(); }, 2000);
        }).catch(() => {
        showStatus('Error saving to Google Sheets!', 'error');
        });
    }

    function fetchSummary() {
    fetch(GOOGLE_SCRIPT_URL)
        .then(response => response.json())
        .then(summary => {
        for (const cat in categoryTotals) {
            categoryTotals[cat] = summary[cat] || 0;
        }
        updateSummary();
        }).catch(() => {
        showStatus('Error loading summary from Google Sheets!', 'error');
        });
    }

    window.onload = function() {
    fetchSummary();
    updateDisplay();
    updateCheckInButton();
    }

    function updateSummary() {
      for (const cat in categoryTotals) {
        document.getElementById('summary-' + cat).textContent = categoryTotals[cat];
      }
      let total = Object.values(categoryTotals).reduce((a,b) => a+b, 0);
      document.getElementById('summary-total').textContent = total;
    }

    function showStatus(msg, type) {
      let el = document.getElementById('statusMessage');
      el.textContent = msg;
      el.style.color = (type === 'error') ? '#ef4444' : (type === 'success' ? '#10b981' : '#eab308');
    }
    function clearStatus() {
      let el = document.getElementById('statusMessage');
      el.textContent = '';
      el.style.color = '#eab308';
    }
    function updateCheckInButton() {
      let btn = document.getElementById('checkin-btn');
      btn.disabled = !selectedCategory || currentCount === 0;
      btn.style.opacity = btn.disabled ? 0.6 : 1;
      btn.style.cursor = btn.disabled ? 'not-allowed' : 'pointer';
    }
    /*function saveTotals() {
      try {
        localStorage.setItem('categoryTotals', JSON.stringify(categoryTotals));
      } catch(e) {}
    }
    function loadTotals() {
      try {
        let st = localStorage.getItem('categoryTotals');
        if (st) {
          let t = JSON.parse(st);
          for (let cat in categoryTotals) if (typeof t[cat] === 'number') categoryTotals[cat] = t[cat];
        }
      } catch(e) {}
    }*/

    window.onload = function() {
      loadTotals();
      updateSummary();
      updateDisplay();
      updateCheckInButton();
    }
  </script>
</body>
</html>